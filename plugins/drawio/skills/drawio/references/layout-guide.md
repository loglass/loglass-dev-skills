# レイアウトガイド

draw.io ダイアグラムのレイアウト原則、座標計算、配置パターン。

## レイアウト原則

### 1. 要素のグループ分けと配置

関連する要素をゾーンに分けて配置する:

```text
┌─────────────┐  ┌─────────────┐  ┌─────────────┐
│  集約A      │  │  集約B      │  │ サービス/   │
│  (左)       │  │  (中央)     │  │ リポジトリ  │
│             │  │             │  │  (右)       │
└─────────────┘  └─────────────┘  └─────────────┘
```

### 2. エッジの接続位置を分散

同じ要素に複数のエッジが接続する場合、`exitX`/`exitY`/`entryX`/`entryY` を使って接続位置を分散させる:

```xml
<!-- 上部から接続 -->
exitX=0.5;exitY=0;entryX=0.5;entryY=1

<!-- 左側上部から接続 -->
exitX=0;exitY=0.25;entryX=1;entryY=0.25

<!-- 左側下部から接続 -->
exitX=0;exitY=0.75;entryX=1;entryY=0.75
```

**座標の意味:**
- `exitX=0` 左端、`exitX=1` 右端、`exitX=0.5` 中央
- `exitY=0` 上端、`exitY=1` 下端、`exitY=0.5` 中央

### 3. 縦方向の関係は縦に配置

親子関係やコンポジションは縦に並べる:

```text
  ┌──────┐
  │ 親   │
  └──┬───┘
     │
  ┌──┴───┐
  │ 子   │
  └──────┘
```

### 4. 横方向の参照は横に配置

集約間の参照関係は横に並べて直線で結ぶ:

```text
┌──────┐      ┌──────┐
│集約A │ ───→ │集約B │
└──────┘      └──────┘
```

### 5. サービス・リポジトリは端に配置

ドメインサービスやリポジトリは図の端（右側など）にまとめて配置し、集約との線が交差しにくくする。

## レイアウト例（ドメインモデル）

```text
┌─────────────────────────────────────────────────────────┐
│                                                         │
│  ┌─────────┐    ┌─────────┐    ┌─────────────────────┐ │
│  │ 集約A   │───→│ 集約B   │    │ ドメインサービス    │ │
│  │ ┌─────┐ │    │ ┌─────┐ │    │ ・PricingPolicy     │ │
│  │ │Root │ │    │ │Root │ │    │ ・StockAllocator    │ │
│  │ └──┬──┘ │    │ └──┬──┘ │    └─────────┬───────────┘ │
│  │    │    │    │    │    │              │             │
│  │ ┌──┴──┐ │    │ ┌──┴──┐ │    ┌─────────┴───────────┐ │
│  │ │Child│ │    │ │Child│ │    │ リポジトリ          │ │
│  │ └─────┘ │    │ └─────┘ │    │ ・OrderRepository    │ │
│  └─────────┘    └─────────┘    │ ・ProductRepository  │ │
│                                └─────────────────────┘ │
│                                                         │
│  ┌────────────────────────────────────────────────────┐ │
│  │ 凡例                                               │ │
│  └────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

## 境界線の座標計算

グループ内の子要素を別の境界線で囲む場合、**座標系の違い**に注意する。

**問題**: 子要素は親からの相対座標、境界線は絶対座標になりがち

**計算式:**
```
絶対座標 = 親の座標 + 子の相対座標
```

### 例: ユースケース図でスコープ境界を作る場合

```xml
<!-- 親（システム境界）-->
<mxCell id="uc-boundary" ... parent="1">
  <mxGeometry x="280" y="100" ... />
</mxCell>

<!-- 子（ユースケース）- 親からの相対座標 -->
<mxCell id="uc1" ... parent="uc-boundary">
  <mxGeometry y="60" height="60" ... />  <!-- 相対: y=60〜120 -->
</mxCell>
<mxCell id="uc2" ... parent="uc-boundary">
  <mxGeometry y="150" height="60" ... /> <!-- 相対: y=150〜210 -->
</mxCell>
```

**絶対座標への変換:**
- uc1: 100(親y) + 60 = 160、下端 = 160 + 60 = 220
- uc2: 100(親y) + 150 = 250、下端 = 250 + 60 = 310

**境界線の座標（余白10px）:**
```xml
<!-- スコープ境界 - 絶対座標で指定 -->
<mxCell id="scope-boundary" ... parent="1">
  <mxGeometry y="150" height="170" ... />  <!-- 160-10 〜 310+10 -->
</mxCell>
```

### チェックリスト

1. 囲む対象の `parent` を確認 → 相対座標か絶対座標か
2. 親の座標を足して絶対座標に変換
3. 余白（10px程度）を加味して範囲を決定
